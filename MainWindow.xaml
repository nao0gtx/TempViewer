<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="TransparentWinUI3.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="TempView">

    <Grid Background="Transparent"
          AllowDrop="True"
          DragOver="RootGrid_DragOver"
          Drop="RootGrid_Drop">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Central Empty State Overlay -->
        <StackPanel x:Name="EmptyStateOverlay"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="12"
                    Visibility="Visible">
            <FontIcon Glyph="&#xEB9F;" FontSize="48" Opacity="0.3"/>
            <TextBlock Text="拖放图片到此处，或点击 + 打开"
                       FontSize="16"
                       Opacity="0.4"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Single TabView spanning entire window -->
        <TabView x:Name="ImageTabView"
                 Grid.Row="0"
                 VerticalAlignment="Stretch"
                 VerticalContentAlignment="Stretch"
                 HorizontalContentAlignment="Stretch"
                 TabWidthMode="Equal"
                 CanReorderTabs="True"
                 CanDragTabs="True"
                 AddTabButtonClick="TabView_AddTabButtonClick"
                 TabCloseRequested="TabView_TabCloseRequested"
                 SelectionChanged="TabView_SelectionChanged"
                 Background="Transparent"
                 IsAddTabButtonVisible="True">
            
            <TabView.Resources>
                <!-- Override TabView resources for full transparency -->
                <SolidColorBrush x:Key="TabViewItemHeaderBackground" Color="Transparent"/>
                <SolidColorBrush x:Key="TabViewItemHeaderBackgroundSelected" Color="#20FFFFFF"/>
                <SolidColorBrush x:Key="TabViewItemHeaderBackgroundPointerOver" Color="#10FFFFFF"/>
                <SolidColorBrush x:Key="TabViewContentBackground" Color="Transparent"/>
                <SolidColorBrush x:Key="TabViewBackground" Color="Transparent"/>
                <x:Double x:Key="TabViewItemMinWidth">40</x:Double>
                <x:Double x:Key="TabViewItemMaxWidth">200</x:Double>
            </TabView.Resources>
            
            <TabView.TabStripHeader>
                <!-- Menu Button (Interaction area) -->
                <Button x:Name="MenuButton" 
                        Width="40" Height="36"
                        Margin="4,0,8,0"
                        Background="Transparent"
                        BorderThickness="0">
                    <Button.Content>
                        <FontIcon Glyph="&#xE700;" FontSize="16"/>
                    </Button.Content>
                    <Button.Flyout>
                        <MenuFlyout Placement="BottomEdgeAlignedLeft">
                            <MenuFlyoutItem x:Name="OpenImageMenuItem" 
                                            Text="打开图片" 
                                            Click="OpenImageMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE8B9;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem x:Name="OpenRawMenuItem" 
                                            Text="打开 RAW" 
                                            Click="OpenRawMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE722;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem x:Name="SettingsMenuItem" 
                                            Text="设置" 
                                            Click="SettingsMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE713;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutSeparator/>
                            <MenuFlyoutItem x:Name="ExitMenuItem" 
                                            Text="退出程序" 
                                            Click="ExitMenuItem_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE711;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Button.Flyout>
                </Button>
            </TabView.TabStripHeader>

            <TabView.TabStripFooter>
                <!-- Spacer for system window buttons (Min/Max/Close) -->
                <Grid Width="188" Background="Transparent"/>
            </TabView.TabStripFooter>

            <!-- Default Home Tab (Minimal) -->
            <TabViewItem x:Name="HomeTab" Header="开始" IsClosable="False">
                <TabViewItem.IconSource>
                    <SymbolIconSource Symbol="Home"/>
                </TabViewItem.IconSource>
                <TabViewItem.Content>
                    <!-- Toolbar + content wrapper -->
                    <Grid Background="Transparent">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <!-- Toolbar -->
                        <Grid x:Name="HomeToolbar"
                              Grid.Row="0"
                              Height="40"
                              Padding="12,0,12,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.Background>
                                <SolidColorBrush Color="#18FFFFFF"/>
                            </Grid.Background>


                            <Border Grid.ColumnSpan="3" BorderThickness="0,0,0,1" 
                                    BorderBrush="#10FFFFFF"
                                    VerticalAlignment="Bottom"/>
                        </Grid>
                        <!-- Empty content -->
                        <Grid Grid.Row="1" Background="Transparent"/>
                    </Grid>
                </TabViewItem.Content>
            </TabViewItem>
        </TabView>
    </Grid>
</Window>
