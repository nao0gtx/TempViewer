<UserControl
    x:Class="TransparentWinUI3.Controls.ColorManagedImageControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="Black">
        <canvas:CanvasSwapChainPanel x:Name="SwapChainPanel" Loaded="SwapChainPanel_Loaded" SizeChanged="SwapChainPanel_SizeChanged" CompositionScaleChanged="SwapChainPanel_CompositionScaleChanged"/>
        
        <!-- WebView2 for native HDR rendering -->
        <WebView2 x:Name="HdrWebView" Visibility="Collapsed" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />

        <!-- Universal Control Overlay (Visible on Hover/Always for now) -->
        <StackPanel x:Name="UniversalToolbar" VerticalAlignment="Top" HorizontalAlignment="Right" Orientation="Horizontal" Margin="10" Spacing="8">
            <Button x:Name="WebViewToggleBtn" Click="WebViewToggleBtn_Click" ToolTipService.ToolTip="Toggle WebView2/Win2D">
                <SymbolIcon x:Name="WebViewIcon" Symbol="Globe"/>
            </Button>
            <Button x:Name="FullscreenImageBtn" Click="FullscreenImageBtn_Click" ToolTipService.ToolTip="Toggle Immersive Fullscreen">
                <SymbolIcon x:Name="FullscreenIcon" Symbol="FullScreen"/>
            </Button>
            <Button x:Name="OpenLabButton" Content="HDR Synthesis Lab" Click="OpenLabButton_Click" Style="{StaticResource AccentButtonStyle}" Visibility="Collapsed"/>
        </StackPanel>
        
        <StackPanel x:Name="HdrPromptPanel" Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
            <TextBlock x:Name="HdrPromptTitle" Text="Advanced HDR Synthesis Lab" Foreground="White" HorizontalAlignment="Center" FontSize="16" FontWeight="SemiBold"/>
            <StackPanel x:Name="HdrSelectionPanel" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                <Button x:Name="LossyConvertButton" Content="Lossy Synthesis (Fast)" Click="LossyConvertButton_Click" Style="{StaticResource AccentButtonStyle}"/>
                <Button x:Name="LosslessConvertButton" Content="Lossless Synthesis (10-bit)" Click="LosslessConvertButton_Click" Style="{StaticResource AccentButtonStyle}"/>
                <ToggleButton x:Name="LabToggle" Content="Adjust Parameters" Click="LabToggle_Click"/>
            </StackPanel>

            <StackPanel x:Name="SynthesisLabPanel" Visibility="Collapsed" Background="#33000000" Padding="15" CornerRadius="8" Spacing="10" MinWidth="400">
                <TextBlock Text="Ultra HDR Parameters" FontSize="14" FontWeight="Bold" HorizontalAlignment="Center"/>
                
                <StackPanel Spacing="5">
                    <Grid>
                        <TextBlock Text="Max Boost" FontSize="12"/>
                        <TextBlock x:Name="MaxBoostValueText" Text="4.00" HorizontalAlignment="Right" FontSize="12" Foreground="SlateGray"/>
                    </Grid>
                    <Slider x:Name="LabMaxBoostSlider" Minimum="1.0" Maximum="10.0" Value="4.0" StepFrequency="0.1" TickFrequency="1.0" ValueChanged="LabSlider_ValueChanged"/>
                </StackPanel>

                <StackPanel Spacing="5">
                    <Grid>
                        <TextBlock Text="Gamma" FontSize="12"/>
                        <TextBlock x:Name="GammaValueText" Text="0.70" HorizontalAlignment="Right" FontSize="12" Foreground="SlateGray"/>
                    </Grid>
                    <Slider x:Name="LabGammaSlider" Minimum="0.1" Maximum="2.0" Value="0.7" StepFrequency="0.05" TickFrequency="0.5" ValueChanged="LabSlider_ValueChanged"/>
                </StackPanel>

                <Button x:Name="SaveSynthesisButton" Content="Save Ultra HDR JPEG" Click="SaveSynthesisButton_Click" Style="{StaticResource AccentButtonStyle}" HorizontalAlignment="Stretch" Visibility="Visible" IsEnabled="False"/>
                <TextBlock x:Name="LabCommandPreview" Text="Intermediate files will be kept in UltraHdr_Workspace" FontSize="10" Foreground="LightSkyBlue" TextWrapping="Wrap" Opacity="0.7" HorizontalAlignment="Center"/>
            </StackPanel>

            <TextBlock x:Name="HdrStatusText" Text="" Foreground="Gray" HorizontalAlignment="Center" FontSize="12"/>
        </StackPanel>
        
        <!-- Debug Overlay for Logs -->
        <TextBlock x:Name="DebugLogText" Text="{x:Bind CMDebugInfo, Mode=OneWay}" 
                   Foreground="LimeGreen" HorizontalAlignment="Left" VerticalAlignment="Top" 
                   Margin="10" FontSize="10" Opacity="0.8" IsHitTestVisible="False" Visibility="Collapsed"/>

        <ProgressRing x:Name="LoadingRing" IsActive="False" HorizontalAlignment="Center" VerticalAlignment="Center" Width="48" Height="48"/>
    </Grid>
</UserControl>
